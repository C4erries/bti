# –°—Ç–∞—Ç—É—Å —á–∞—Ç-–±–æ—Ç–∞ Gemini

## ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### 1. **–ú–æ–¥—É–ª—å —á–∞—Ç-–±–æ—Ç–∞**
- **–ü—É—Ç—å:** `ai/app/app/services/chat/chatbot.py`
- **–§—É–Ω–∫—Ü–∏—è:** `process_chat_message()`
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–∞–π–¥–µ–Ω–∞

### 2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Backend**
- **–°–µ—Ä–≤–∏—Å:** `backend/app/services/ai_integration_service.py`
- **–§—É–Ω–∫—Ü–∏—è:** `process_chat_with_ai()`
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** `backend/app/services/chat_service.py` ‚Üí `delegate_to_ai()`
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ

### 3. **API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã**
- `POST /api/v1/client/chats/{chat_id}/messages` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
- `POST /api/v1/client/orders/{order_id}/chat` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç –∑–∞–∫–∞–∑–∞
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç

### 4. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**
- **GEMINI_API_KEY:** ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω –≤ `ai/_env` –∏ `ai/app/.env`
- **GEMINI_MODEL:** ‚úÖ gemini-2.0-flash
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ

## üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:**
   - –ß–µ—Ä–µ–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Üí API —ç–Ω–¥–ø–æ–∏–Ω—Ç
   - –°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î

2. **Backend –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç AI:**
   - `chat_service.delegate_to_ai()` –ø–æ–ª—É—á–∞–µ—Ç:
     - –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
     - –ö–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–∫–∞–∑–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
     - –î–∞–Ω–Ω—ã–µ –ø–ª–∞–Ω–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
     - –ò—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π)
     - –ü—Ä–∞–≤–∏–ª–∞ AI (–ø–æ–∫–∞ –ø—É—Å—Ç–æ)
     - –°—Ç–∞—Ç—å–∏ –∑–∞–∫–æ–Ω–∞ (–ø–æ–∫–∞ –ø—É—Å—Ç–æ)

3. **AI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:**
   - `ai_integration_service.process_chat_with_ai()` –≤—ã–∑—ã–≤–∞–µ—Ç
   - `ai/app/app/services/chat/chatbot.py` ‚Üí `process_chat_message()`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Gemini API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç RAG –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–ª–∞–Ω (–µ—Å–ª–∏ –µ—Å—Ç—å)

4. **–û—Ç–≤–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:**
   - AI –æ—Ç–≤–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç "AI"
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

1. **–ò–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è:**
   ```bash
   cd backend
   python3 -c "from app.services.ai_integration_service import process_chat_with_ai; print('OK')"
   ```

2. **GEMINI_API_KEY:**
   ```bash
   cat ai/_env | grep GEMINI_API_KEY
   ```

3. **–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å:**
   ```bash
   curl -X POST "http://localhost:8000/api/v1/client/chats/{chat_id}/messages" \
     -H "Authorization: Bearer {token}" \
     -H "Content-Type: application/json" \
     -d '{"message": "–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?"}'
   ```

## ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **AI_MODULES_AVAILABLE = False**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç –º–æ–¥—É–ª–µ–π –≤ `ai_integration_service.py`
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø—É—Ç—å –∫ `ai/app` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

2. **"AI chat not available"**
   - –ú–æ–¥—É–ª—å –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend

3. **–û—à–∏–±–∫–∞ Gemini API**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å GEMINI_API_KEY
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–≤–æ—Ç—ã API

## üöÄ –ó–∞–ø—É—Å–∫

–ß–∞—Ç-–±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ backend:
```bash
./start-local.sh
```

Gemini API –∫–ª—é—á –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑:
- `ai/_env` ‚Üí `ai/app/.env`
- `backend/.env` (–µ—Å–ª–∏ –µ—Å—Ç—å)

