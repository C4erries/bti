# ‚úÖ –ß–∞—Ç-–±–æ—Ç Gemini - –°—Ç–∞—Ç—É—Å

## üéØ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### 1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** ‚úÖ
- –ú–æ–¥—É–ª—å —á–∞—Ç-–±–æ—Ç–∞: `ai/app/app/services/chat/chatbot.py`
- –§—É–Ω–∫—Ü–∏—è: `process_chat_message()`
- Backend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: `backend/app/services/ai_integration_service.py`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: `backend/app/services/chat_service.py` ‚Üí `delegate_to_ai()`

### 2. **API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã** ‚úÖ
- `POST /api/v1/client/chats/{chat_id}/messages` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
- `POST /api/v1/client/orders/{order_id}/chat` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç –∑–∞–∫–∞–∑–∞

### 3. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** ‚úÖ
- **GEMINI_API_KEY:** –ù–∞—Å—Ç—Ä–æ–µ–Ω –≤ `ai/_env` –∏ `ai/app/.env`
- **GEMINI_MODEL:** gemini-2.0-flash
- **–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ

## üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ** ‚Üí API —ç–Ω–¥–ø–æ–∏–Ω—Ç
2. **Backend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ** –≤ –ë–î
3. **Backend –≤—ã–∑—ã–≤–∞–µ—Ç `delegate_to_ai()`** —Å:
   - –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
   - –ö–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–∫–∞–∑–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –î–∞–Ω–Ω—ã–µ –ø–ª–∞–Ω–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π)
4. **AI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ Gemini API:**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç RAG –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–ª–∞–Ω (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
5. **–û—Ç–≤–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** –≤ –ë–î –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

- ‚úÖ –£–±—Ä–∞–Ω—ã –∏–º–ø–æ—Ä—Ç—ã `v2.models` ‚Üí –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ `models`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `ai/app/app/services/__init__.py` (—É–±—Ä–∞–Ω plan_processing)
- ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è

## üöÄ –ó–∞–ø—É—Å–∫:

–ß–∞—Ç-–±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ backend:
```bash
./start-local.sh
```

## üìù –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

```bash
# –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
curl -X POST "http://localhost:8000/api/v1/client/chats/{chat_id}/messages" \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{"message": "–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?"}'
```

## ‚ö†Ô∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏—è:

- –ï—Å–ª–∏ AI –º–æ–¥—É–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback: `"AI stub: {message}"`
- –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ backend –ª–æ–≥–∞—Ö
- GEMINI_API_KEY –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º –¥–ª—è —Ä–∞–±–æ—Ç—ã

